{% extends 'base.html' %}
{% load sekizai_tags static %}
{% block body %}
    <!-- COMMON INFO -->
    <div class="row">
        <div class="col-md-8">
            {% if restaurant.is_closed %}
                <div class="alert alert-danger" role="alert">CLOSED</div>

            {% endif %}
            <h1>{{ restaurant.name }}
                <div class="pull-right">
                    <div class="btn-group">
                        {% if user.is_authenticated %}
                            {% if user.is_venue_moderator %}
                                <a class="btn btn-success"
                                   href="{% url "venues.views.venuess.update_restaurant" restaurant.pk %}">
                                    <span class="glyphicon glyphicon-edit"></span>
                                </a>

                            {% endif %}
                        {% endif %}
                        <a class="btn btn-warning"
                           href="{% url "venues.views.reports.report_restaurant" restaurant.pk %}">
                            <span class="glyphicon glyphicon-warning-sign"></span>
                        </a>
                        {% if user.is_authenticated %}
                            {% if user.is_venue_moderator %}
                                <a class="btn btn-danger"
                                   href="{% url "venues.views.venuess.remove_restaurant" restaurant.pk %}">
                                    <span class="glyphicon glyphicon-remove"></span>
                                </a>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
            </h1>

            <h2>{{ restaurant.cuisine }}</h2>
            <h4>{{ restaurant.eatingOptions }}</h4>

            <h3>{{ restaurant.address }}</h3>

            <div class="row">
                {% if  restaurant.phone %}
                    <div class="col-md-12">
                        <h3><span class="glyphicon glyphicon-earphone"></span> {{ restaurant.phone }}</h3>
                    </div>
                {% endif %}
            </div>

            <div class="r-categories">
                <ul>
                    {% for category in restaurant.categories.all %}
                        <li>{{ category.name }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        <!-- GOOGLE MAP -->
        <div class="col-md-4">
            <div id="map-canvas" style="width: 100%; height: 300px"></div>

        </div>
        <!-- END GOOGLE MAP -->
    </div>
    <!-- ENDCOMMON INFO -->

    <hr/>
    <div class="row">
        <div class="col-md-8">
            {% if user.is_authenticated %}
                {% include 'comments/comment-form.html' %}
                <hr/>
            {% endif %}
            {% for comment in comments %}
                {% include "comments/comment.html" %}
            {% endfor %}
        </div>
        <div class="col-md-4">
            {% if user.is_authenticated %}
                <div class="panel panel-default">
                    <div class="panel-body">
                        <form autocomplete="off" action="{% url "venues.views.notes.add_note" restaurant.id %}"
                              method="post">
                            {% if user.is_authenticated %}
                                {% include 'notes/note-form.html' %}
                            {% endif %}
                        </form>
                    </div>
                </div>
            {% endif %}
            {% for note in notes %}
                {% include "notes/note.html" %}
            {% endfor %}
        </div>
    </div>
    {% addtoblock "js" %}
        <!-- google-maps scripts -->
        <script src="https://maps.googleapis.com/maps/api/js"></script>
        <script>
            function initialize() {
                var mapCanvas = document.getElementById('map-canvas');
                latlng = new google.maps.LatLng({{restaurant.location.y}}, {{restaurant.location.x}});
                var mapOptions = {
                    center: latlng,
                    zoom: 16,
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    mapTypeControl: false
                };
                var map = new google.maps.Map(mapCanvas, mapOptions);
                var marker = new google.maps.Marker({
                    position: latlng,
                    map: map,
                    title: '{{ restaurant.name }} | {{ restaurant.address }}'
                });
            }
            google.maps.event.addDomListener(window, 'load', initialize);
        </script>
        <script>
            $(function () {
                console.log($(".note-remove"));
                $(".note-remove").click(function (event) {
                    if (!confirm("Are you sure?")) {
                        return false;
                    }
                })
            });
        </script>
    {% endaddtoblock %}
{% endblock %}